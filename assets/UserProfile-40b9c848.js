import{_ as ae,a as se}from"./yes_login-65e1999f.js";import{o as v,c as G,w as ne,a as w,u as a,R as re,r as g,b as W,d as m,e as k,v as R,f as u,t as $,g as h,h as x,i as q,j as M,F as V,k as le,_ as ie,l as oe,m as I,n as O,p as L,q as F,s as N,x as ue,y as U,z}from"./index-0d521d25.js";import ce from"./nameInput-6232c3cb.js";import{c as de,a as B,u as _e,d as ve,g as me}from"./fetch-5f5bc1cf.js";import{u as E}from"./auth-2058c0d8.js";import{_ as ge}from"./close-ed01941b.js";const he={__name:"gameButton",setup(e){return(s,r)=>(v(),G(a(re),{class:"base-button game-button game-button_right",to:"/game"},{default:ne(()=>[w("к матчу")]),_:1}))}},pe="/darts-calculator/assets/edit-67c88e4c.svg",be=()=>{const e=g(""),s=g(!1);return{errorMessage:e,beginChange:s,changeName:async(t,l,n,i)=>{if(s.value=!0,t.currentTarget.value===""){t.currentTarget.focus(),s.value=!1;return}if(t.currentTarget.value===n.users[l].name){i(),s.value=!1;return}try{const{response:o,json:c}=await de(l,n,{changableParameter:{name:t.currentTarget.value}});await E(l,n,c),await B(c,o),n.updateName(l,c.name),localStorage.setItem(`user${l}`,JSON.stringify(n.users[l])),i(),s.value=!1}catch(o){e.value=o.message,i(),s.value=!1}}}};const fe={class:"user-information__name-wrapper"},ye={class:"user-information__name"},$e=u("img",{src:pe,alt:"edit",class:"icon-32",title:"изменить имя"},null,-1),Ce=[$e],De={key:0,class:"user-information__change-name"},Ve={__name:"userName",props:{player:String},setup(e){const s=le({loader:()=>ie(()=>import("./popUp-c10c4e15.js"),["assets/popUp-c10c4e15.js","assets/index-0d521d25.js","assets/index-46c032b2.css","assets/popUp-42c57df3.css"])}),r=W(),{visibility:t,showElement:l,hideElement:n}=_e(),{errorMessage:i,beginChange:o,changeName:c}=be();return(_,d)=>{var p,f;return v(),m(V,null,[k(u("div",fe,[u("h3",ye,$((p=a(r).users[e.player])==null?void 0:p.name),1),u("button",{class:"user-information__settings-button settings-button",onClick:d[0]||(d[0]=(...y)=>a(l)&&a(l)(...y))},Ce)],512),[[R,!a(t)]]),a(t)?(v(),m("div",De,[h(ce,{disabled:a(o),startName:(f=a(r).users[e.player])==null?void 0:f.name,onKeydown:d[1]||(d[1]=x(q(y=>y.currentTarget.blur(),["prevent"]),["enter"])),onBlur:d[2]||(d[2]=y=>a(c)(y,e.player,a(r),a(n)))},null,8,["disabled","startName"])])):M("",!0),h(a(s),{popUpSeen:!!a(i),popUpMessage:a(i),popUpDuration:4e3,where:"top",howFar:"0px",onClosePopUp:d[3]||(d[3]=y=>i.value="")},null,8,["popUpSeen","popUpMessage"])],64)}}},Se="/darts-calculator/assets/delete-01fa86d0.svg",xe=async(e,s,r)=>{try{const{response:t,json:l}=await ve(e,s);await E(e,s,l),await B(l,t),s.logout(e),localStorage.removeItem(`user${e}`),r.push("/")}catch(t){console.error(t)}},Ne=e=>{e.showModal()},we=e=>{e.close()};const ke=u("img",{src:Se,alt:"delete",class:"icon-32",title:"удалить профиль"},null,-1),Ie=[ke],Pe={class:"dialog-content-wrapper"},Ze={class:"delete-message"},Ue=u("p",{class:"p-message"}," Вы собираетесь удалить свой профиль. Вместе с ним будет удалена статистика матчей. Подтвердите удаление профиля. ",-1),Re={class:"buttons"},Oe={__name:"deleteUser",props:{player:String},setup(e){const s=W(),r=oe(),t=g(null);return(l,n)=>(v(),m(V,null,[u("button",{class:"user-information__delete-button settings-button",onClick:n[0]||(n[0]=i=>a(Ne)(t.value))},Ie),u("dialog",{class:"dialog",ref_key:"deleteModal",ref:t,onCancel:n[3]||(n[3]=q(()=>{},["prevent"]))},[u("div",Pe,[u("div",Ze,[Ue,u("div",Re,[u("button",{class:"delete-buttons base-button",onClick:n[1]||(n[1]=i=>a(xe)(e.player,a(s),a(r)))}," Удалить профиль "),u("button",{class:"delete-buttons base-button",onClick:n[2]||(n[2]=i=>a(we)(t.value))}," Отмена ")])])])],544)],64))}};const We={class:"user-profile__information user-information"},Me=u("div",{class:"user-information__avatar avatar"},[u("img",{class:"avatar__img",src:ae,alt:"avatar"})],-1),ze={__name:"userProfile",props:{player:String},setup(e){return(s,r)=>(v(),m("div",We,[h(Oe,{player:e.player},null,8,["player"]),Me,h(Ve,{player:e.player},null,8,["player"])]))}},Be=(e,s,r,t)=>{const l=g(e.value),n=g(s.value);I(r,()=>{l.value=r.start,n.value=r.end,o()}),I(e,()=>{l.value=e.value,o()}),I(s,()=>{l.value=s.value,o()});const i=()=>{Ee(l,e.value,s.value),Te(n,e.value,s.value),Ae(l,n,e.value,s.value)},o=()=>{i(),t("updateDates",l.value,n.value)};return{startDate:l,endDate:n,changeDateInterval:o}},Ee=(e,s,r)=>{const t=e.value.split("-").map(i=>Number(i)),l=s.split("-").map(i=>Number(i)),n=r.split("-").map(i=>Number(i));if(t[0]<l[0]||t[0]>n[0]){e.value=s;return}if(t[0]===l[0]&&t[1]<l[1]){e.value=s;return}if(t[0]===n[0]&&t[1]>n[1]){e.value=s;return}if(t[0]===l[0]&&t[1]===l[1]&&t[2]<l[2]){e.value=s;return}if(t[0]===n[0]&&t[1]===n[1]&&t[2]>n[2]){e.value=s;return}},Te=(e,s,r)=>{const t=e.value.split("-").map(i=>Number(i)),l=s.split("-").map(i=>Number(i)),n=r.split("-").map(i=>Number(i));if(t[0]<l[0]||t[0]>n[0]){e.value=r;return}if(t[0]===l[0]&&t[1]<l[1]){e.value=r;return}if(t[0]===n[0]&&t[1]>n[1]){e.value=r;return}if(t[0]===l[0]&&t[1]===l[1]&&t[2]<l[2]){e.value=r;return}if(t[0]===n[0]&&t[1]===n[1]&&t[2]>n[2]){e.value=r;return}},Ae=(e,s,r,t)=>{const l=e.value.split("-").map(i=>Number(i)),n=s.value.split("-").map(i=>Number(i));if(l[0]>n[0]){e.value=r,s.value=t;return}if(l[0]===n[0]&&l[1]>n[1]){e.value=r,s.value=t;return}if(l[0]===n[0]&&l[1]===n[1]&&l[2]>n[2]){e.value=r,s.value=t;return}};const Ke={class:"date-interval"},Le={class:"date-interval__from date-interval_margin-right"},Fe=u("h6",{class:"date-interval__header"},"с",-1),je=["min","max"],He={class:"date-interval__to"},Ge=u("h6",{class:"date-interval__header"},"по",-1),qe=["min","max"],J={__name:"dateInterval",props:{minDate:String,maxDate:String,globalRangeDate:Object},emits:["updateDates"],setup(e,{emit:s}){const r=e,{startDate:t,endDate:l,changeDateInterval:n}=Be(O(r,"minDate"),O(r,"maxDate"),r.globalRangeDate,s);return(i,o)=>(v(),m("div",Ke,[u("label",Le,[Fe,k(u("input",{class:"date-interval__value",type:"date","onUpdate:modelValue":o[0]||(o[0]=c=>F(t)?t.value=c:null),min:r.minDate,max:r.maxDate,onBlur:o[1]||(o[1]=(...c)=>a(n)&&a(n)(...c)),onKeypress:o[2]||(o[2]=x(c=>c.currentTarget.blur(),["enter"]))},null,40,je),[[L,a(t)]])]),u("label",He,[Ge,k(u("input",{class:"date-interval__value",type:"date","onUpdate:modelValue":o[3]||(o[3]=c=>F(l)?l.value=c:null),min:r.minDate,max:r.maxDate,onBlur:o[4]||(o[4]=(...c)=>a(n)&&a(n)(...c)),onKeypress:o[5]||(o[5]=x(c=>c.currentTarget.blur(),["enter"]))},null,40,qe),[[L,a(l)]])])]))}},X=e=>{switch(e){case"averagePoints":return"Средний набор";case"averagePointsWinLegs":return"Выигранные леги";case"averagePointsLoseLegs":return"Проигранные леги";case"averageFirstNineDarts":return"9 дротиков";case"p180":return"180 очков";case"p171":return"171+ очков";case"p131":return"131+ очков";case"p96":return"96+ очков";case"percentDouble":return"Процент удвоений";case"highestCheckout":return"Наибольшие закрытия";default:return e}},D=e=>e.split("-").reverse().join("-"),Je=e=>{const s=g(D(e[0].date)),r=g(D(e.at(-1).date)),t=N(()=>e.filter(o=>Xe(D(o.date),s.value,r.value))),l=N(()=>t.value.filter(o=>o.value>0)),n=N(()=>t.value.length>0?Math.max(...t.value.map(o=>o.value)):0);return{chartDataInInterval:t,chartDataInIntervalWithoutZero:l,maxValue:n,updateDates:(o,c)=>{s.value=o,r.value=c}}},Xe=(e,s,r)=>{const t=e.split("-").map(i=>Number(i)),l=s.split("-").map(i=>Number(i)),n=r.split("-").map(i=>Number(i));return!(t[0]<l[0]||t[0]>n[0]||t[0]===l[0]&&t[1]<l[1]||t[0]===n[0]&&t[1]>n[1]||t[0]===l[0]&&t[1]===l[1]&&t[2]<l[2]||t[0]===n[0]&&t[1]===n[1]&&t[2]>n[2])},Ye=e=>{const s=g(!0),r=()=>s.value=!s.value;return I(e,()=>{s.value=!a(e)}),{hideZerosInChart:s,changeHideZerosInChart:r}},j=e=>{const s=N(()=>e.value.length*7+e.value.length-1>260?e.value.length*7+e.value.length-1:260),r=300,t=N(()=>Qe(s.value,e.value.length));return{chartWidth:s,chartHeight:r,lineWidth:t}},Qe=(e,s)=>{const r=s-1;let t=(e-r)/s;return t>25&&(t=25),t<7&&(t=7),t},et=e=>{const s={countParameterName:at(e),scoreParameterName:tt(e),date:g(""),score:g(null),count:g(null),fillInfo(n,i,o){s.date.value=n,s.score.value=i,s.count.value=o},resetInfo(){s.date.value="",s.score.value=null,s.count.value=null}},r=g(!1);return{parameterInfo:s,parameterInfoVisivility:r,showParameterInfo:(n,i,o)=>{s.fillInfo(n,i,o),r.value=!0},hideParameterInfo:()=>r.value=!1}},tt=e=>e.includes("очков")?"количество":e==="Процент удвоений"?"средний процент":e==="Наибольшие закрытия"?"закрытие":"средний набор",at=e=>{switch(e){case"Выигранные леги":return"выиграно легов";case"Проигранные леги":return"проиграно легов";default:return"сыграно легов"}},Y=(e,s,r)=>e/s*r||7,H=(e,s)=>e*s+e,st=(e,s,r)=>e-Y(e,s,r);const nt={class:"chart-box"},rt={class:"chart-box__head"},lt=["data-max"],it={class:"cross-line"},ot=["height","x","y","onPointerover"],ut={class:"chart-box__info"},ct={__name:"statChart",props:{chartName:String,chartData:Array,globalVisibilityOfZeroValues:Boolean,globalRangeDate:Object},setup(e){const s=e;ue(P=>({"06f33d6e":a(d),"84b51302":a(p),"7b73ad7c":a(y),edeed6e8:a(f),"51d45938":a(T)}));const r=s.chartData.filter(P=>P.value>0),t=X(s.chartName),{chartDataInInterval:l,chartDataInIntervalWithoutZero:n,maxValue:i,updateDates:o}=Je(s.chartData),{hideZerosInChart:c,changeHideZerosInChart:_}=Ye(O(s,"globalVisibilityOfZeroValues")),{chartWidth:d,chartHeight:p,lineWidth:f}=j(l),{chartWidth:y,lineWidth:T}=j(n),{parameterInfo:C,parameterInfoVisivility:Q,showParameterInfo:ee,hideParameterInfo:A}=et(t);return(P,S)=>{var K;return v(),m("div",nt,[u("h4",rt,$(a(t)),1),u("div",{class:"chart-wrapper","data-max":(a(i)%1===0?a(i):a(i).toFixed(2))||""},[u("button",{class:U(["chart__show-zero",{"chart__show-zero_border":!a(c)}]),onClick:S[0]||(S[0]=(...b)=>a(_)&&a(_)(...b)),title:"Изменить видимость нулевых результатов"},[w(" 0 "),k(u("span",it,null,512),[[R,a(c)]])],2),u("div",{class:"chart",onPointerleave:S[2]||(S[2]=(...b)=>a(A)&&a(A)(...b))},[(v(),m("svg",{class:U({chart__svg:!a(c),"chart__svg-without-zero":a(c)})},[(v(!0),m(V,null,z(a(c)?a(n):a(l),(b,Z)=>(v(),m("rect",{class:U(["chart__line",{"chart__line_without-zero":a(c)}]),key:Z+s.chartName+b.date,height:String(a(Y)(a(p),a(i),b.value))+"%",x:a(c)?String(a(H)(Z,a(T))/a(y)*100)+"%":String(a(H)(Z,a(f))/a(d)*100)+"%",y:String(a(st)(a(p),a(i),b.value)/a(p)*100)+"%",onPointerover:te=>a(ee)(b.date,b.value,b.count),onPointerleave:S[1]||(S[1]=te=>a(C).resetInfo())},null,42,ot))),128))],2))],32),k(u("div",ut,[u("p",null,$(a(C).scoreParameterName)+": "+$(a(C).score.value%1===0?a(C).score.value:(K=a(C).score.value)==null?void 0:K.toFixed(2)),1),u("p",null,$(a(C).countParameterName)+": "+$(a(C).count.value),1),u("p",null,"дата: "+$(a(C).date.value),1)],512),[[R,a(Q)]])],8,lt),h(J,{minDate:a(D)(a(c)&&a(r)[0]?a(r)[0].date:s.chartData[0].date),maxDate:a(D)(a(c)&&a(r)[0]?a(r).at(-1).date:s.chartData.at(-1).date),globalRangeDate:s.globalRangeDate,onUpdateDates:a(o)},null,8,["minDate","maxDate","globalRangeDate","onUpdateDates"])])}}},dt="/darts-calculator/assets/settings-c81a478f.svg";const _t={class:"settings__zero-seen zero-seen"},vt=u("h3",{class:"settings__header"},[w("Отображать нулевые"),u("br"),w("значения")],-1),mt=["checked"],gt={__name:"zeroVisibility",props:{globalVisibilityOfZeroValues:Boolean},emits:["update:globalVisibilityOfZeroValues"],setup(e){return(s,r)=>(v(),m("label",_t,[vt,u("input",{type:"checkbox",class:"zero-seen__value",checked:e.globalVisibilityOfZeroValues,onChange:r[0]||(r[0]=t=>s.$emit("update:globalVisibilityOfZeroValues",t.currentTarget.checked)),onKeyup:r[1]||(r[1]=x(t=>s.$emit("update:globalVisibilityOfZeroValues",!t.currentTarget.checked),["enter"]))},null,40,mt)]))}};const ht={class:"settings__date"},pt=u("h3",{class:"settings__header"},"Интервал дат",-1),bt={__name:"dateSetting",props:{minDate:String,maxDate:String},emits:["updateDates"],setup(e){return(s,r)=>(v(),m("div",ht,[pt,h(J,{minDate:a(D)(e.minDate),maxDate:a(D)(e.maxDate),globalRangeDate:g("Mock data"),onUpdateDates:r[0]||(r[0]=(t,l)=>s.$emit("updateDates",t,l))},null,8,["minDate","maxDate","globalRangeDate"])]))}};const ft={class:"settings__chart-visibility chart-visibility"},yt=u("h3",{class:"settings__header"},"Видимость графиков",-1),$t={class:"chart-visibility__values"},Ct={class:"chart-visibility__value"},Dt=["checked","onChange","onKeyup"],Vt={__name:"chartVisibility",props:{visibleCharts:Set,chartNames:Array},emits:["update:visibleCharts"],setup(e){return(s,r)=>(v(),m("div",ft,[yt,u("div",$t,[(v(!0),m(V,null,z(e.chartNames,t=>(v(),m("div",{class:"chart-visibility__box-value",key:t},[u("label",Ct,[u("input",{type:"checkbox",checked:e.visibleCharts.has(t),onChange:l=>s.$emit("update:visibleCharts",t),onKeyup:x(l=>s.$emit("update:visibleCharts",t),["enter"])},null,40,Dt),w(" "+$(a(X)(t)),1)])]))),128))])]))}},St=()=>{const e=g(!1);return{chartsSettingsVisibility:e,openChartSettings:()=>e.value=!0,closeChartSettings:()=>e.value=!1}};const xt=u("img",{src:dt,alt:"settings",class:"icon-32",title:"настройка отображения графиков"},null,-1),Nt=[xt],wt=u("img",{src:ge,alt:"close",class:"icon-32",title:"закрыть настройку"},null,-1),kt=[wt],It={__name:"chartSettings",props:{globalVisibilityOfZeroValues:Boolean,visibleCharts:Set,chartNames:Array,minChartDate:String,maxChartDate:String},emits:["update:globalVisibilityOfZeroValues","update:visibleCharts","updateDates"],setup(e){const{chartsSettingsVisibility:s,openChartSettings:r,closeChartSettings:t}=St();return(l,n)=>(v(),m(V,null,[u("button",{class:"charts__settings-button settings-button",onClick:n[0]||(n[0]=(...i)=>a(r)&&a(r)(...i))},Nt),a(s)?(v(),m("div",{key:0,class:"charts__settings settings",onKeyup:n[5]||(n[5]=x((...i)=>a(t)&&a(t)(...i),["esc"]))},[u("button",{class:"charts__settings-button settings-button",onClick:n[1]||(n[1]=(...i)=>a(t)&&a(t)(...i))},kt),h(gt,{globalVisibilityOfZeroValues:e.globalVisibilityOfZeroValues,"onUpdate:globalVisibilityOfZeroValues":n[2]||(n[2]=i=>l.$emit("update:globalVisibilityOfZeroValues",i))},null,8,["globalVisibilityOfZeroValues"]),h(bt,{minDate:e.minChartDate,maxDate:e.maxChartDate,onUpdateDates:n[3]||(n[3]=(i,o)=>l.$emit("updateDates",i,o))},null,8,["minDate","maxDate"]),h(Vt,{chartNames:e.chartNames,visibleCharts:e.visibleCharts,"onUpdate:visibleCharts":n[4]||(n[4]=i=>l.$emit("update:visibleCharts",i))},null,8,["chartNames","visibleCharts"])],32)):M("",!0)],64))}},Pt=(e,s)=>{const r=g(null),t=g(""),l={zeroSeen:g(!1),visible:g(new Set),minDate:"",maxDate:"",globalRangeDate:g({start:"",end:"",updateGlobalDates(_,d){l.globalRangeDate.value.start=_,l.globalRangeDate.value.end=d}}),updateVisibleCharts(_){l.visible.value.delete(_)||l.visible.value.add(_)}};n(e,s);async function n(_,d){try{const{response:p,json:f}=await me(_,d);await E(_,d,f),await B(f,p),r.value=f.statistic,await i(r.value),await o(r.value,l)}catch(p){t.value=p.message}}const i=async _=>{if(!Object.keys(_)[0])throw new Error("Статистика отсутствует")},o=async(_,d)=>{d.visible.value=new Set(c(_)),d.minDate=_.averagePoints[0].date,d.maxDate=_.averagePoints.at(-1).date},c=_=>Object.keys(_).filter(d=>!!_[d][0]);return{statistic:r,messageError:t,chartsSettings:l,getStatNamesWithValues:c}};const Zt={class:"page user-profile"},Ut={key:0,class:"charts"},Rt={key:1,class:"loading-message"},Tt={__name:"UserProfile",props:{player:String},setup(e){const s=e,r=W(),{statistic:t,messageError:l,chartsSettings:n,getStatNamesWithValues:i}=Pt(s.player,r);return(o,c)=>(v(),m("div",Zt,[h(se),h(he),h(ze,{player:e.player},null,8,["player"]),a(t)?(v(),m("div",Ut,[h(It,{globalVisibilityOfZeroValues:a(n).zeroSeen.value,"onUpdate:globalVisibilityOfZeroValues":c[0]||(c[0]=_=>a(n).zeroSeen.value=_),visibleCharts:a(n).visible.value,"onUpdate:visibleCharts":a(n).updateVisibleCharts,chartNames:a(i)(a(t)),minChartDate:a(n).minDate,maxChartDate:a(n).maxDate,onUpdateDates:a(n).globalRangeDate.value.updateGlobalDates},null,8,["globalVisibilityOfZeroValues","visibleCharts","onUpdate:visibleCharts","chartNames","minChartDate","maxChartDate","onUpdateDates"]),(v(!0),m(V,null,z(a(t),(_,d)=>(v(),m(V,{key:d},[a(n).visible.value.has(d)&&_[0]?(v(),G(ct,{key:0,chartName:d,chartData:_,globalVisibilityOfZeroValues:a(n).zeroSeen.value,globalRangeDate:a(n).globalRangeDate.value},null,8,["chartName","chartData","globalVisibilityOfZeroValues","globalRangeDate"])):M("",!0)],64))),128))])):(v(),m("div",Rt,$(a(l)||"Загружается статистика игрока"),1))]))}};export{Tt as default};
