import{_ as X,a as Y}from"./homeButton-fe61744d.js";import{u as q,a as l,r as d,c as b,o as h,b as f,d as c,t as g,n as G,e as E,w as S,v as W,F as B,f as O,g as F,h as z,i as j,j as Q,R as ee,k as te,l as A,m as ae}from"./index-a42a8121.js";const re=t=>{switch(t){case"averagePoints":return"Средний набор";case"averagePointsWinLegs":return"Выигранные леги";case"averagePointsLoseLegs":return"Проигранные леги";case"averageFirstNineDarts":return"9 дротиков";case"p180":return"180 очков";case"p171":return"171+ очков";case"p131":return"131+ очков";case"p96":return"96+ очков";case"percentDouble":return"Процент удвоений";case"highestCheckout":return"Наибольшие закрытия";default:return t}},se=t=>t.includes("очков")?"количество":t==="Процент удвоений"?"средний процент":t==="Наибольшие закрытия"?"закрытие":"средний набор",ne=t=>{switch(t){case"Выигранные леги":return"выиграно легов";case"Проигранные леги":return"проиграно легов";default:return"сыграно легов"}},C=t=>t.split("-").reverse().join("-"),oe=(t,r,o)=>{const e=t.split("-").map(n=>Number(n)),a=r.split("-").map(n=>Number(n)),s=o.split("-").map(n=>Number(n));return!(e[0]<a[0]||e[0]>s[0]||e[0]===a[0]&&e[1]<a[1]||e[0]===s[0]&&e[1]>s[1]||e[0]===a[0]&&e[1]===a[1]&&e[2]<a[2]||e[0]===s[0]&&e[1]===s[1]&&e[2]>s[2])},D=(t,r,o)=>t/r*o||7,le=(t,r)=>t*r+t,ue=(t,r,o)=>t-D(t,r,o),ce=(t,r)=>{const o=r-1;let e=(t-o)/r;return e>25&&(e=25),e<7&&(e=7),e},ie=(t,r,o)=>{const e=t.value.split("-").map(n=>Number(n)),a=r.split("-").map(n=>Number(n)),s=o.split("-").map(n=>Number(n));if(e[0]<a[0]||e[0]>s[0]){t.value=r;return}if(e[0]===a[0]&&e[1]<a[1]){t.value=r;return}if(e[0]===s[0]&&e[1]>s[1]){t.value=r;return}if(e[0]===a[0]&&e[1]===a[1]&&e[2]<a[2]){t.value=r;return}if(e[0]===s[0]&&e[1]===s[1]&&e[2]>s[2]){t.value=r;return}},ve=(t,r,o)=>{const e=t.value.split("-").map(n=>Number(n)),a=r.split("-").map(n=>Number(n)),s=o.split("-").map(n=>Number(n));if(e[0]<a[0]||e[0]>s[0]){t.value=o;return}if(e[0]===a[0]&&e[1]<a[1]){t.value=o;return}if(e[0]===s[0]&&e[1]>s[1]){t.value=o;return}if(e[0]===a[0]&&e[1]===a[1]&&e[2]<a[2]){t.value=o;return}if(e[0]===s[0]&&e[1]===s[1]&&e[2]>s[2]){t.value=o;return}},_e=(t,r,o,e)=>{const a=t.value.split("-").map(n=>Number(n)),s=r.value.split("-").map(n=>Number(n));if(a[0]>s[0]){t.value=o,r.value=e;return}if(a[0]===s[0]&&a[1]>s[1]){t.value=o,r.value=e;return}if(a[0]===s[0]&&a[1]===s[1]&&a[2]>s[2]){t.value=o,r.value=e;return}};const de={class:"chart-box"},he={class:"chart-box__head"},me=["data-max"],pe={class:"cross-line"},fe={class:"chart__svg"},ge=["height","x","y","onPointerover"],ye={class:"chart-box__info"},ke={class:"date-interval"},Ne={class:"date-interval__from date-interval_margin-right"},be=c("h6",{class:"date-interval__header"},"с",-1),we=["min","max"],xe={class:"date-interval__to"},Se=c("h6",{class:"date-interval__header"},"по",-1),Te=["min","max"],Ve={__name:"statChart",props:{parameterName:String,chartData:Array},setup(t){const r=t;q(p=>({"5e212188":l(k),"332f7e71":m,"3cf7f0fe":l(L)}));const o=re(r.parameterName),e=C(r.chartData[0].date),a=C(r.chartData.at(-1).date),s=d(e),n=d(a),N=d(e),y=d(a),v=b(()=>r.chartData.filter(p=>oe(C(p.date),N.value,y.value))),u=d(!0),w=b(()=>v.value.filter(p=>p.value>0)),k=b(()=>v.value.length*7+v.value.length-1>260?v.value.length*7+v.value.length-1:260),m=300,L=b(()=>ce(k.value,v.value.length)),T=b(()=>Math.max(...v.value.map(p=>p.value))),V=d(!1),$=d(""),P=d(0),I=d(0),J=ne(o),K=se(o),R=(p,_,x)=>{$.value=p,P.value=_,I.value=x,V.value=!0},Z=()=>{$.value="",P.value=null,I.value=null},H=()=>{ie(s,e,a),ve(n,e,a),_e(s,n,e,a)},M=()=>{H(),N.value=s.value,y.value=n.value};return(p,_)=>{var x;return h(),f("div",de,[c("h4",he,g(l(o)),1),c("div",{class:"chart-wrapper","data-max":l(T).toFixed(2)||""},[c("button",{class:G(["chart__show-zero",{"chart__show-zero_border":!u.value}]),onClick:_[0]||(_[0]=i=>u.value=!u.value),title:"Изменить видимость нулевых результатов"},[E(" 0 "),S(c("span",pe,null,512),[[W,u.value]])],2),c("div",{class:"chart",onPointerleave:_[1]||(_[1]=i=>V.value=!1)},[(h(),f("svg",fe,[(h(!0),f(B,null,O(u.value?l(w):l(v),(i,U)=>(h(),f("rect",{class:"chart__line",key:U+r.parameterName+i.date,height:String(l(D)(m,l(T),i.value))+"%",x:String(l(le)(U,l(L))/l(k)*100)+"%",y:String(l(ue)(m,l(T),i.value)/m*100)+"%",onPointerover:Ue=>R(i.date,i.value,i.count),onPointerleave:Z},null,40,ge))),128))]))],32),S(c("div",ye,[c("p",null,g(l(K))+": "+g((x=P.value)==null?void 0:x.toFixed(2)),1),c("p",null,g(l(J))+": "+g(I.value),1),c("p",null,"дата: "+g($.value),1)],512),[[W,V.value]])],8,me),c("div",ke,[c("label",Ne,[be,S(c("input",{class:"date-interval__value",type:"date","onUpdate:modelValue":_[2]||(_[2]=i=>s.value=i),min:l(e),max:l(a),onBlur:M,onKeypress:_[3]||(_[3]=z(i=>i.currentTarget.blur(),["enter"]))},null,40,we),[[F,s.value]])]),c("label",xe,[Se,S(c("input",{class:"date-interval__value",type:"date","onUpdate:modelValue":_[4]||(_[4]=i=>n.value=i),min:l(e),max:l(a),onBlur:M,onKeypress:_[5]||(_[5]=z(i=>i.currentTarget.blur(),["enter"]))},null,40,Te),[[F,n.value]])])])])}}};const $e={__name:"gameButton",setup(t){return(r,o)=>(h(),j(l(ee),{class:"base-button game-button game-button_right",to:"/game"},{default:Q(()=>[E("к матчу")]),_:1}))}};const Pe={class:"page user-profile"},Ie={class:"user-profile__information user-information"},Ce=c("div",{class:"user-information__avatar avatar"},[c("img",{class:"avatar__img",src:X,alt:"avatar"})],-1),Be={class:"user-information__name"},Le={key:0,class:"charts"},Me={key:1,class:"loading-message"},ze={__name:"UserProfile",props:{player:String},setup(t){const r=t,o=te(),e=d(null);s(r.player);const a=d("");async function s(n){var w,k;const N="https://darts-calculator-api.onrender.com/statistic/get",y={method:"POST",body:JSON.stringify({refreshToken:((w=o.users[n])==null?void 0:w.refreshToken)||""}),headers:{authorization:`Bearer ${(k=o.users[n])==null?void 0:k.token}`,"Content-Type":"application/json"}};let v,u;try{v=await fetch(N,y),u=await v.json()}catch(m){console.error(m),a.value="Ошибка сервера получении статистики";return}if(u&&Object.hasOwn(u,"newTokens")){o.updateTokens(n,u.newTokens.token,u.newTokens.refreshToken);const m=JSON.parse(localStorage.getItem(`user${n}`));m.token=u.newTokens.token,m.refreshToken=u.newTokens.refreshToken,localStorage.setItem(`user${n}`,JSON.stringify(m))}if(u&&Object.hasOwn(u,"error")){console.error(u.error),a.value=u.error;return}if(!u||!v.ok&&!Object.hasOwn(u,"error")){a.value="Не удалось получить статистику";return}e.value=u.statistic,e.value[0]||(a.value="Статистика отсутствует")}return(n,N)=>(h(),f("div",Pe,[A(Y),A($e),c("div",Ie,[Ce,c("h3",Be,g(l(o).users[r.player].name),1)]),e.value?(h(),f("div",Le,[(h(!0),f(B,null,O(e.value,(y,v)=>(h(),f(B,{key:v},[y[0]?(h(),j(Ve,{key:0,parameterName:v,chartData:y},null,8,["parameterName","chartData"])):ae("",!0)],64))),128))])):(h(),f("div",Me,g(a.value||"Загружается статистика игрока"),1))]))}};export{ze as default};
